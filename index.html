<meta charset="utf-8" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/easyqrcodejs@4.4.5/dist/easy.qrcode.min.js"></script>

<div>
  <input id="urlInput" type="text" placeholder="URL 입력" style="width:300px;">
  <button id="dlBtn">다운로드</button>
  <br><br>
  <div id="qrContainer"></div>
</div>

<script>
$(function () {
  // --- 다국어 텍스트 ---
  const i18n = {
    ko: {
      placeholder: 'URL 입력',
      download: '다운로드',
      invalid: 'URL을 입력하세요.'
    },
    en: {
      placeholder: 'Enter URL',
      download: 'Download',
      invalid: 'Please enter a URL.'
    },
    ja: {
      placeholder: 'URLを入力',
      download: 'ダウンロード',
      invalid: 'URLを入力してください。'
    }
  };

  // --- 언어 자동 감지: ?lang= > navigator.language ---
  function detectLang() {
    const qs = new URLSearchParams(location.search);
    const q = (qs.get('lang') || '').toLowerCase();
    if (q === 'ko' || q === 'en' || q === 'ja') return q;

    const nav = (navigator.language || '').toLowerCase();
    if (nav.startsWith('ja')) return 'ja';
    if (nav.startsWith('en')) return 'en';
    if (nav.startsWith('ko')) return 'ko';
    return 'ko'; // 기본값
  }

  const lang = detectLang();
  const t = i18n[lang] || i18n.ko;
  document.documentElement.lang = lang;

  // UI 문구 적용
  $('#urlInput').attr('placeholder', t.placeholder);
  $('#dlBtn').text(t.download).attr('aria-label', t.download);

  // --- QR 생성 로직 ---
  let qr;
  function createQR(url) {
    $('#qrContainer').empty();
    qr = new QRCode(document.getElementById('qrContainer'), {
      text: url,
      width: 256,
      height: 256,
      dotScale: 1,
      drawFunction: 'canvas'
    });
  }

  $('#urlInput').on('input', function () {
    const url = $(this).val();
    if (url.trim()) {
      createQR(url);
    } else {
      $('#qrContainer').empty();
    }
  });

  $('#dlBtn').on('click', function () {
    const canvas = $('#qrContainer').find('canvas')[0];
    if (!canvas) {
      alert(t.invalid);
      return;
    }
    const a = document.createElement('a');
    a.href = canvas.toDataURL(); // PNG
    a.download = 'qrcode.png';
    a.click();
  });
});
</script>
